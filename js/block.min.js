function millisecondsToTime(a){return Math.floor(a/6E4%60)+":"+Math.floor(a/1E3%60)+"."+a%1E3}
var stopper={start:function(){this.startDate=new Date;this.getCurrentDate();this.step=100;var a=this;this.timer=setInterval(function(){a.getCurrentDate()},this.step)},stop:function(){clearInterval(this.timer)},getCurrentDate:function(){this.currentDate=new Date;this.time=this.currentDate-this.startDate;this.printTime(this.time)},printTime:function(a){a=Math.floor(a/1E3);var c=a%60;a=Math.floor(a/60);var b=a%60;a=Math.floor(a/60);document.getElementById("timer").innerHTML=a+":"+b+":"+c}},parent=document.getElementById("canvas-container"),
container=document.getElementById("main-view"),homeView=document.getElementById("home-view"),homeViewControllers=document.getElementById("HomeViewControllers"),settings=document.getElementById("settings-view"),main=document.getElementById("main-id"),winWIDTH=window.innerWidth,boxWIDTH=window.innerWidth-20,winHEIGHT=window.innerHeight,boxHEIGHT=window.innerHeight-60,bW=Math.floor(window.innerWidth/15)-5,bH=Math.floor((window.innerHeight-90)/10)-5;bW>bH&&(bW=bH);
var GameType="hero",GameLevel=6,GameSpeed=100,GameScore=0,GameCombo=0,boxColumns=10,boxRows=10,facebookLoginBox=!0,allBrickets=[],player={name:"Vend\u00e9g",id:0,fid:0,score:0,time:"",lastTime:0},cords={lbDiv:"",color:"",x:0,y:0,id:0},gl=null,gNum=0,boxItemNum=100,lastboxItemNum=boxItemNum,Game={init:function(){Game.start()},start:function(){Game.cButton("startSasBtn","SASSZEM m\u00f3d","","","","",Game.goView,"startBtn",homeViewControllers);Game.cButton("homeBtn","F\u0151oldal","0px","0px","","",
Game.goView,"controllBtn",container);Game.cButton("settingsBtn","Be\u00e1ll\u00edt\u00e1s","0px","","","0px",Game.goView,"settingsBtn",homeView);Game.cButton("settingsBtn","Be\u00e1ll\u00edt\u00e1s","0px","","","0px",Game.goView,"settingsBtn",container);Game.cButton("homeBtn","F\u0151oldal","0px","0px","","",Game.goView,"controllBtn",settings);Game.cButton("startBtn","J\u00e1t\u00e9k","0px","","","0px",Game.goView,"controllBtn",settings);Game.hText("score","Pontsz\u00e1m:","h2","70px","10px","gameScore",
container);Game.hText("level","Szint: <span>1</span>","h2","70px","45%","gameScore",container);Game.hText("levelText","Szint: <span>1</span>","h2","50%","20%","levelText",container);Game.hText("timer","00:00:00","h2","70px","75%","gameScore",container);$("#welcomeMessage").insertBefore(document.getElementById("startSasBtn"));Game.defaultData();Game.updateSettings();Game.getDB()},restart:function(){window.location.reload()},share:function(){postToFeed();return!1},cButton:function(a,c,b,d,e,f,g,l,k){var h=
document.createElement("button");h.innerHTML=c;""!=d&&(h.style.left=d);""!=b&&(h.style.top=b);""!=e&&(h.style.bottom=e);""!=f&&(h.style.right=f);h.id=a;h.style.zIndex="97";h.className=l;h.addEventListener("click",g);"startBtn"==l?k.insertBefore(h,k.firstChild):k.appendChild(h)},hText:function(a,c,b,d,e,f,g){b=document.createElement(b);b.id=a;b.style.top=d;b.style.left=e;b.style.position="absolute";"levelText"!=a&&(b.style.zIndex=9);b.className=f;b.innerHTML=c;g.appendChild(b)},hDialog:function(a,
c,b,d,e,f,g){b=document.createElement(b);b.id=a;b.style.top=d;b.style.left=e;b.style.position="absolute";b.className=f;b.innerHTML=c;g.appendChild(b)},cBrick:function(a,c,b,d,e,f){bW>bH&&(bW=bH);e=document.createElement("div");e.style.top=b*bH+"px";e.style.left=c*bW+"px";e.style.width=bW-3+"px";e.style.height=bH-3+"px";e.className="bricket color"+d+"";e.id=a;e.style.display="block";e.addEventListener("click",clickBrick,!1);main.appendChild(e)},goView:function(a){var c=String(parent.className);"startSasBtn"!=
a.target.id&&"startHeroBtn"!=a.target.id||!c.match(/homeView/g)||(parent.className="container gameView",parent.style.marginLeft=-winWIDTH+"px",timer&&stopper.stop(),stopper.start(),"startSasBtn"==a.target.id?(Game.updateSettings(!0),GameType="sas",Game.buildPlacc(!1)):(Game.updateSettings(!0),GameType="hero",Game.buildPlacc(!0)));"settingsBtn"==a.target.id&&c.match(/homeView/g)&&(parent.className="container settingsView",parent.style.marginLeft=-(2*winWIDTH)+"px",Game.updateSettings());"homeBtn"==
a.target.id&&c.match(/gameView/g)&&(parent.className="container homeView",parent.style.marginLeft="0px");"settingsBtn"==a.target.id&&c.match(/gameView/g)&&(parent.className="container settingsView",parent.style.marginLeft=-(2*winWIDTH)+"px",Game.updateSettings());"startBtn"==a.target.id&&c.match(/settingsView/g)&&(parent.className="container gameView",parent.style.marginLeft=-winWIDTH+"px",Game.updateSettings(),Game.buildPlacc(!1));"homeBtn"==a.target.id&&c.match(/settingsView/g)&&(parent.className=
"container homeView",parent.style.marginLeft="0px",Game.updateSettings())},makeRnd:function(){return"hero"==GameType?Math.floor(Math.random()*GameLevel):Math.floor(4*Math.random())},getBrick:function(a){return 0<=a.x&&0<=a.y&&a.x<boxRows&&a.y<boxColumns&&document.getElementById("brick_"+a.x+"_"+a.y)?document.getElementById("brick_"+a.x+"_"+a.y):!1},gravity:function(){for(var a=!1,c=boxRows,b=boxColumns,d=0;d<c-1;d++)for(var e=0;e<b;e++)Game.getBrick({x:d,y:e})&&!1==Game.getBrick({x:d+1,y:e})&&(Game.getBrick({x:d,
y:e}).style.top=parseInt(Game.getBrick({x:d,y:e}).style.top)+Number(bH)+"px",Game.getBrick({x:d,y:e}).id="brick_"+(d+1)+"_"+e,a=!0);a&&Game.gravity()},slide:function(){for(var a=Number(boxRows),c=Number(boxColumns),b=[],d=!1,e=1;e<c;e++)if(Game.getBrick({x:a-1,y:e})&&!1==Game.getBrick({x:a-1,y:e-1}))for(var f=0;f<c;f++)Game.getBrick({x:f,y:e})&&b.push({x:f,y:e});if(0<b.length)for(var g in b)Game.getBrick({x:b[g].x,y:b[g].y}).style.left=parseInt(Game.getBrick({x:b[g].x,y:b[g].y}).style.left)-Number(bW)+
"px",Game.getBrick({x:b[g].x,y:b[g].y}).id="brick_"+b[g].x+"_"+(b[g].y-1),d=!0;d&&Game.slide()},checkBrick:function(a){var c={},b=0;Game.getBrick({x:a.x-1,y:a.y})&&Game.getBrick({x:a.x-1,y:a.y}).className==a.color&&(b+=1,c={x:a.x-1,y:a.y});Game.getBrick({x:a.x,y:a.y-1})&&Game.getBrick({x:a.x,y:a.y-1}).className==a.color&&(b+=1,c={x:a.x,y:a.y-1});Game.getBrick({x:a.x+1,y:a.y})&&Game.getBrick({x:a.x+1,y:a.y}).className==a.color&&(b+=1,c={x:a.x+1,y:a.y});Game.getBrick({x:a.x,y:a.y+1})&&Game.getBrick({x:a.x,
y:a.y+1}).className==a.color&&(b+=1,c={x:a.x,y:a.y+1});GameCombo=b;if(0===b)return!1;if(2<=b)return!0;if(a.tried)return!1;c.color=a.color;c.tried=!0;return Game.checkBrick(c)},getCords:function(a){var c={x:0,y:0,color:"",tried:!1};if(!a.id)return!1;var b=a.id.split("_");c.x=parseInt(b[1]);c.y=parseInt(b[2]);c.color=a.className;return c},checkLevel:function(){allBrickets=main.getElementsByTagName("div");if(100==allBrickets.length)return!0;for(var a in allBrickets)if(Game.getCords(allBrickets[a])&&
Game.checkBrick(Game.getCords(allBrickets[a])))return!0;return!1},deleteBrick:function(a){var c=Game.getBrick({x:a.x,y:a.y}).className,b=0,d=function(a){var f;b++;(f=Game.getBrick({x:a.x,y:a.y}))&&f.className===c&&(main.removeChild(Game.getBrick({x:a.x,y:a.y})),GameScore=Number(GameScore)+1,d({x:a.x-1,y:a.y}),d({x:a.x,y:a.y-1}),d({x:a.x+1,y:a.y}),d({x:a.x,y:a.y+1}))};d(a);Game.gravity();Game.slide();GameCombo=b},defaultData:function(){"undefined"!==typeof Storage?(GameType="hero",GameLevel=10,GameSpeed=
100,GameCombo=GameScore=0,boxRows=boxColumns=6,bW=Math.floor(boxWIDTH/Number(boxColumns)),bH=Math.floor((boxHEIGHT-55)/Number(boxRows)),bW>bH&&(bW=bH)):Game.debug(428,"Sorry! No web storage support..")},getDB:function(){var a=openDatabase("gamedata","1.0","Kocska DB",2097152);a.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS SCORES (id unique, name, fid, score, date, time)")});a.transaction(function(a){a.executeSql("SELECT * FROM SCORES order by score desc, time asc limit 10 ",[],
function(a,c){var e=c.rows.length,f;for(f=0;f<e;f++){var g=f+1,l=document.getElementById("scoreTable");console.log(g+" / "+c.rows.item(f).name+" / "+c.rows.item(f).score);var k=l.insertRow(l.rows.length),l=k.insertCell(0),h=k.insertCell(1),m=k.insertCell(2),k=k.insertCell(3);l.innerHTML="<b>"+g+".</b>";h.innerHTML=c.rows.item(f).name;m.innerHTML=c.rows.item(f).score;k.innerHTML=c.rows.item(f).time;player.id=g+1}},null)})},levelUpText:function(a){levelText.innerHTML="Szint: <span>"+a+"</span>";levelText.className+=
" active";setTimeout(function(){levelText.className="levelText"},1E3)},updateSettings:function(a){$(".main").css({width:winWIDTH+"px",height:winHEIGHT+"px"});$(".container").css({width:3*winWIDTH+"px"});$(".views").css({width:winWIDTH+"px",height:winHEIGHT+"px"});$(".gameView").css({marginLeft:-winWIDTH+"px"});$("#HomeViewControllers").css({marginTop:winHEIGHT/3+"px"});$(".game-view").css({width:boxColumns*bW+"px",margin:"50px auto"});a&&(bW=Math.floor(boxWIDTH/Number(boxColumns)),bH=Math.floor((boxHEIGHT-
55)/Number(boxRows)),bW>bH&&(bW=bH));main.innerHTML=""},buildPlacc:function(a,c,b){c=Number(boxRows);b=Number(boxColumns);if(!0===a)for(a=0;a<c;a++)for(var d=0;d<b;d++)Game.getBrick({x:a,y:d})||Game.cBrick("brick_"+a+"_"+d,d,a,Game.makeRnd(),a,!1);else for(a=0;a<c;a++)for(d=0;d<b;d++)Game.cBrick("brick_"+a+"_"+d,d,a,Game.makeRnd(),a,!1)},debug:function(a,c){var b=(new Date).toLocaleString();console.log(b+"-"+a+": "+c);return!1}};
function clickBrick(a){a=$(this).attr("id").split("_");var c=main.getElementsByTagName("div");cords.y=parseInt(a[2]);cords.x=parseInt(a[1]);cords.color=this.className;Game.checkBrick(cords)&&Game.deleteBrick(cords);0<GameScore&&(GameScore=Number(GameScore)+Number(GameCombo),player.score=GameScore,player.time=document.getElementById("timer").innerHTML);$("#score").html("Pontsz\u00e1m: <span>"+GameScore+"</span>");$("#level").html("Szint: <span>"+(Number(GameLevel)-3)+"</span>");Game.debug(586,"check"+
Game.checkLevel());if(!Game.checkLevel()&&c.length!=Number(boxRows)*Number(boxColumns)){var b=(new Date).getTime();openDatabase("gamedata","1.0","Kocka DB",2097152).transaction(function(a){"Vend\u00e9g"==player.name&&(player.name+=" "+player.id+". ");a.executeSql("INSERT INTO SCORES (id, name, fid, score, date, time) VALUES ("+parseInt(player.id)+', "'+player.name+'", '+player.fid+", "+parseInt(player.score)+", "+b+', "'+player.time+'")')});"sas"==GameType&&15>GameLevel?(GameLevel=Number(GameLevel)+
1,boxColumns=Number(boxColumns)+1,boxRows=Number(boxRows)+1,bW=Math.floor(winWIDTH/boxColumns)-5,bH=Math.floor((winHEIGHT-90)/boxRows)-5,bW>bH&&(bW=bH),main.innerHTML="",Game.buildPlacc(!1),Game.levelUpText(Number(GameLevel)-3),level.innerHTML="Szint: <span>"+(Number(GameLevel)-3)+"</span>",3<Number(GameLevel)&&(main.className="level0"+(Number(GameLevel)-3))):(console.log(GameType+"."+GameLevel),Game.hDialog("end","V\u00e9ge a J\u00e1t\u00e9knak","div","150px","30%","gameOver",container),a=document.getElementById("end"),
Game.hText("score","Pontsz\u00e1m:"+player.score,"p","55px","20px","gameScore",a),Game.hText("share","Oszd meg ismer\u0151seiddel!","p","90px","20px","gameScore",a),Game.cButton("endBtn","\u00daJRA","","","20px","20px",Game.restart,"endBtn",a),Game.cButton("shareBtn","Megosztom","","20px","20px","",Game.share,"shareBtn",a),Game.hDialog("layer","","div","","","gameLayer",container))}}
function demoMode(){document.getElementById("startHeroBtn").style.display="none";document.getElementById("settingsBtn").style.display="none";console.log("demoMode")}FB.init({appId:"448852595204459",status:!0,cookie:!0});
FB.getLoginStatus(function(a){a&&"connected"==a.status?FB.api("/me",function(a){player.name=a.first_name;player.fid=a.id;document.getElementById("welcomeMessage").innerHTML="\u00dcdv, "+a.first_name;console.log(a);console.log(a.birthday);$.post("log.php",{time:new Date,player:player},function(){console.log("Save Data")})}):$.post("log.php",{time:new Date,player:player},function(){console.log("Save Data")})});
function postToFeed(){FB.ui({method:"feed",redirect_uri:"http://davidbreuer.hu/games/kocka/",link:"http://davidbreuer.hu/games/kocka/",picture:"http://davidbreuer.hu/games/kocka/images/logo.png",name:"Kocka J\u00e1t\u00e9k",caption:"Pontsz\u00e1mom: "+player.score+".",description:"Gyere \u00e9s d\u00f6ntsd meg!"},function(a){console.log("Post ID: "+a.post_id)})};